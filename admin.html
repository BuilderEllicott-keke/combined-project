<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Intersellar - GE Custom</title>
    <link rel="stylesheet" href="/assets/css/global.css?v=6" />
    <link rel="stylesheet" href="/assets/css/container.css?v=2" />
    <link rel="stylesheet" href="/assets/css/nav.css?v=01" />
    <style>
        body {
            background: #1a1a1a;
            color: #fff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .admin-header {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        .admin-section {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .admin-section h3 {
            color: #fff;
            margin-bottom: 15px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: #333;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #007bff;
        }
        .stat-label {
            color: #ccc;
            font-size: 0.9rem;
        }
        .access-codes {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px;
        }
        .code-item {
            background: #333;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9rem;
        }
        .code-date {
            color: #007bff;
            font-weight: bold;
        }
        .code-value {
            color: #fff;
            margin-top: 5px;
        }
        .admin-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn-danger {
            background: #dc3545;
        }
        .btn-danger:hover {
            background: #c82333;
        }
        .btn-success {
            background: #28a745;
        }
        .btn-success:hover {
            background: #218838;
        }
        .log-entry {
            background: #333;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9rem;
        }
        .log-success {
            border-left: 4px solid #28a745;
        }
        .log-failed {
            border-left: 4px solid #dc3545;
        }
        .log-admin {
            border-left: 4px solid #007bff;
        }
    </style>
</head>
<body>
    <div class="f-nav"></div>
    
    <div class="admin-container">
        <div class="admin-header">
            <h1>üõ°Ô∏è Admin Panel</h1>
            <p>System Administration & Access Management</p>
            <div id="currentDateTime"></div>
        </div>

        <div class="admin-section">
            <h3>üìä System Statistics</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalUsers">-</div>
                    <div class="stat-label">Total Users</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="todayLogins">-</div>
                    <div class="stat-label">Today's Logins</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="activeSessions">-</div>
                    <div class="stat-label">Active Sessions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="failedAttempts">-</div>
                    <div class="stat-label">Failed Attempts</div>
                </div>
            </div>
        </div>

        <div class="admin-section">
            <h3>üîë Access Codes Management</h3>
            <div class="admin-actions">
                <button class="btn" onclick="loadAccessCodes()">Refresh Codes</button>
                <button class="btn btn-success" onclick="generateNewCodes()">Generate New Codes</button>
                <button class="btn btn-danger" onclick="clearAllCodes()">Clear All Codes</button>
            </div>
            <div id="accessCodesList" class="access-codes">
                <!-- Access codes will be loaded here -->
            </div>
        </div>

        <div class="admin-section">
            <h3>üìù Access Logs</h3>
            <div class="admin-actions">
                <button class="btn" onclick="loadAccessLogs()">Refresh Logs</button>
                <button class="btn btn-danger" onclick="clearLogs()">Clear Logs</button>
            </div>
            <div id="accessLogs">
                <!-- Access logs will be loaded here -->
            </div>
        </div>

        <div class="admin-section">
            <h3>‚öôÔ∏è System Actions</h3>
            <div class="admin-actions">
                <button class="btn" onclick="restartSystem()">Restart System</button>
                <button class="btn btn-danger" onclick="emergencyShutdown()">Emergency Shutdown</button>
                <button class="btn btn-success" onclick="exportLogs()">Export Logs</button>
            </div>
        </div>
    </div>

    <script src="/assets/js/001.js?v=001"></script>
    <script>
        // Check if user is admin
        if (localStorage.getItem('userType') !== 'admin') {
            alert('Access denied. Admin privileges required.');
            window.location.href = '/login.html';
        }

        // Update current date/time
        function updateDateTime() {
            const now = new Date();
            const dateTime = now.toLocaleString();
            document.getElementById('currentDateTime').textContent = `Current Time: ${dateTime}`;
        }

        // Load access codes (generated dynamically)
        function loadAccessCodes() {
            const container = document.getElementById('accessCodesList');
            container.innerHTML = '';

            // Generate codes for the next 30 days
            const codes = [];
            const today = new Date();
            
            for (let i = 0; i < 30; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                const dateCode = formatDateCode(date);
                const accessCode = generateAccessCode(date);
                codes.push({ date: dateCode, code: accessCode });
            }

            codes.forEach(code => {
                const codeItem = document.createElement('div');
                codeItem.className = 'code-item';
                codeItem.innerHTML = `
                    <div class="code-date">${code.date}</div>
                    <div class="code-value">${code.code}</div>
                `;
                container.appendChild(codeItem);
            });
        }

        function formatDateCode(date) {
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 
                          'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const month = months[date.getMonth()];
            const day = String(date.getDate()).padStart(2, '0');
            const year = String(date.getFullYear()).slice(-2);
            return `${month}${day}_${year}`;
        }

        function generateAccessCode(date) {
            // This matches the server-side generation
            const seed = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
            const hash = sha256(seed + 'default-salt'); // This should match your SECRET_SALT
            const code1 = hash.substring(0, 10);
            const code2 = hash.substring(10, 20);
            return `${code1}:${code2}`;
        }

        function sha256(str) {
            // Simple SHA-256 implementation for client-side
            const encoder = new TextEncoder();
            const data = encoder.encode(str);
            return crypto.subtle.digest('SHA-256', data).then(hashBuffer => {
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            });
        }

        // Load access logs
        function loadAccessLogs() {
            // In a real implementation, this would fetch from a database
            const logs = [
                { timestamp: '2025-01-15T10:30:00Z', userType: 'user', success: true, ip: '192.168.1.100', dateCode: 'Oct21_25' },
                { timestamp: '2025-01-15T10:25:00Z', userType: 'admin', success: true, ip: '192.168.1.50', dateCode: 'Oct21_25' },
                { timestamp: '2025-01-15T10:20:00Z', userType: 'user', success: false, ip: '192.168.1.101', dateCode: 'Oct21_25' },
                { timestamp: '2025-01-15T10:15:00Z', userType: 'user', success: true, ip: '192.168.1.102', dateCode: 'Oct21_25' },
                { timestamp: '2025-01-15T10:10:00Z', userType: 'user', success: false, ip: '192.168.1.103', dateCode: 'Oct21_25' }
            ];

            const container = document.getElementById('accessLogs');
            container.innerHTML = '';

            logs.forEach(log => {
                const logEntry = document.createElement('div');
                logEntry.className = `log-entry ${log.success ? 'log-success' : 'log-failed'} ${log.userType === 'admin' ? 'log-admin' : ''}`;
                logEntry.innerHTML = `
                    <strong>${new Date(log.timestamp).toLocaleString()}</strong> - 
                    ${log.userType.toUpperCase()} - 
                    ${log.success ? 'SUCCESS' : 'FAILED'} - 
                    IP: ${log.ip} - 
                    Code: ${log.dateCode}
                `;
                container.appendChild(logEntry);
            });
        }

        // Update statistics
        function updateStats() {
            document.getElementById('totalUsers').textContent = '42';
            document.getElementById('todayLogins').textContent = '15';
            document.getElementById('activeSessions').textContent = '8';
            document.getElementById('failedAttempts').textContent = '3';
        }

        // Admin actions
        function generateNewCodes() {
            alert('New access codes generated successfully!');
            loadAccessCodes();
        }

        function clearAllCodes() {
            if (confirm('Are you sure you want to clear all access codes? This will lock out all users!')) {
                alert('All access codes cleared.');
                loadAccessCodes();
            }
        }

        function loadAccessLogs() {
            loadAccessLogs();
        }

        function clearLogs() {
            if (confirm('Are you sure you want to clear all access logs?')) {
                document.getElementById('accessLogs').innerHTML = '<div class="log-entry">Logs cleared.</div>';
            }
        }

        function restartSystem() {
            if (confirm('Are you sure you want to restart the system?')) {
                alert('System restart initiated...');
            }
        }

        function emergencyShutdown() {
            if (confirm('EMERGENCY SHUTDOWN: This will immediately lock out all users. Continue?')) {
                alert('Emergency shutdown activated. All users will be logged out.');
            }
        }

        function exportLogs() {
            alert('Logs exported successfully!');
        }

        // Initialize admin panel
        document.addEventListener('DOMContentLoaded', function() {
            updateDateTime();
            updateStats();
            loadAccessCodes();
            loadAccessLogs();
            
            // Update time every minute
            setInterval(updateDateTime, 60000);
        });
    </script>
</body>
</html>
